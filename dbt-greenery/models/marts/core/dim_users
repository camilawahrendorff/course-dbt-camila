{{
  config(
    materialized='table',
    unique_key='dbt_scd_id'
  )
}}

SELECT 
    u.first_name,
    u.last_name,
    u.email,
    u.created_at,
    u.updated_at,
    u.valid_from,
    u.valid_to

FROM {{ ref('users_snapshot') }} as u
LEFT JOIN {{ ref('stg_addresses')}} as a USING (addres_id)